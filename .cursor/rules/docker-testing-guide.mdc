---
description: 
globs: 
alwaysApply: false
---
# ğŸ³ Docker ê¸°ë°˜ í…ŒìŠ¤íŠ¸ í™˜ê²½ ê°€ì´ë“œ

## ğŸš¨ **í•„ìˆ˜ ì‚¬í•­: ëª¨ë“  í…ŒìŠ¤íŠ¸ëŠ” Docker Compose í™˜ê²½ì—ì„œ ì‹¤í–‰!**

**âš ï¸ ì ˆëŒ€ ìŠì§€ ë§ˆì„¸ìš”: ì´ í”„ë¡œì íŠ¸ì˜ ëª¨ë“  ì„œë²„ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ì™€ í†µí•© í…ŒìŠ¤íŠ¸ëŠ” ë°˜ë“œì‹œ Docker Compose í™˜ê²½ì—ì„œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤!**

## ğŸ¯ ì™œ Docker í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í•´ì•¼ í•˜ë‚˜ìš”?

### 1. ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ ë„¤íŠ¸ì›Œí¬ í†µì‹ 
- embedding-server, llm-server, rag-serverê°€ ì„œë¡œ HTTP í†µì‹ 
- Docker Compose ë„¤íŠ¸ì›Œí¬ì—ì„œë§Œ ì„œë¹„ìŠ¤ ê°„ í˜¸ìŠ¤íŠ¸ëª… í•´ê²° ê°€ëŠ¥
- ì˜ˆ: `http://embedding-server:8001`, `http://llm-server:8002`

### 2. ì‹¤ì œ ìš´ì˜ í™˜ê²½ê³¼ ë™ì¼í•œ ì¡°ê±´
- ì‹¤ì œ ë°°í¬ í™˜ê²½ê³¼ 100% ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ ì„¤ì •
- í¬íŠ¸ ì¶©ëŒ ì—†ì´ ëª¨ë“  ì„œë¹„ìŠ¤ ë™ì‹œ ì‹¤í–‰
- í™˜ê²½ ë³€ìˆ˜ì™€ ì„¤ì •ì´ ì‹¤ì œ ìš´ì˜ í™˜ê²½ê³¼ ì¼ì¹˜

### 3. ë°ì´í„°ë² ì´ìŠ¤ ë° ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™
- PostgreSQL, Qdrant(ë²¡í„°DB) ë“± ì™¸ë¶€ ì„œë¹„ìŠ¤ì™€ ì—°ë™
- ë…ë¦½ì ì¸ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë² ì´ìŠ¤ í™˜ê²½ ì œê³µ

## ğŸ›  Docker Compose í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •

### ğŸ“„ í…ŒìŠ¤íŠ¸ìš© Docker Compose íŒŒì¼

í˜„ì¬ í”„ë¡œì íŠ¸ì—ëŠ” ë‹¤ìŒ Docker Compose íŒŒì¼ë“¤ì´ ìˆìŠµë‹ˆë‹¤:

- [docker-compose.yml](mdc:docker-compose.yml) - ìš´ì˜ í™˜ê²½ìš©
- [docker-compose.dev.yml](mdc:docker-compose.dev.yml) - ê°œë°œ í™˜ê²½ìš©

### ğŸ”§ ê° ì„œë¹„ìŠ¤ë³„ Docker ì„¤ì •

ê° ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ì—ëŠ” ë‹¤ìŒ íŒŒì¼ë“¤ì´ ìˆìŠµë‹ˆë‹¤:

- [embedding-server/Dockerfile](mdc:embedding-server/Dockerfile)
- [llm-server/Dockerfile](mdc:llm-server/Dockerfile)  
- [rag-server/Dockerfile](mdc:rag-server/Dockerfile)

## ğŸš€ Docker í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•˜ëŠ” ë°©ë²•

### 1. ğŸƒâ€â™‚ï¸ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë‹¨ê³„

```bash
# 1ë‹¨ê³„: Docker Composeë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ì‹¤í–‰
docker-compose -f docker-compose.dev.yml up -d

# 2ë‹¨ê³„: ì„œë¹„ìŠ¤ë“¤ì´ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸° (30ì´ˆ ì •ë„)
sleep 30

# 3ë‹¨ê³„: ê°œë³„ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
docker-compose exec rag-server pytest tests/unit/
docker-compose exec embedding-server pytest tests/unit/
docker-compose exec llm-server pytest tests/unit/

# 4ë‹¨ê³„: í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì„œë¹„ìŠ¤ ê°„ í†µì‹  í…ŒìŠ¤íŠ¸)
docker-compose exec rag-server pytest tests/integration/

# 5ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ í™˜ê²½ ì •ë¦¬
docker-compose -f docker-compose.dev.yml down -v
```

### 2. ğŸ¯ íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ í…ŒìŠ¤íŠ¸

```bash
# RAG ì„œë²„ë§Œ í…ŒìŠ¤íŠ¸
docker-compose exec rag-server pytest tests/unit/features/search/

# ì„ë² ë”© ì„œë²„ë§Œ í…ŒìŠ¤íŠ¸  
docker-compose exec embedding-server pytest tests/unit/features/embedding/

# LLM ì„œë²„ë§Œ í…ŒìŠ¤íŠ¸
docker-compose exec llm-server pytest tests/unit/features/chat/
```

### 3. ğŸ” ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸

```bash
# ëª¨ë“  ì„œë¹„ìŠ¤ ë¡œê·¸ í™•ì¸
docker-compose -f docker-compose.dev.yml logs -f

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸ë§Œ í™•ì¸
docker-compose -f docker-compose.dev.yml logs -f rag-server
```

## âš¡ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸

### í…ŒìŠ¤íŠ¸ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ë§Œë“¤ê¸°

ê° ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ì— `run_tests.sh` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ì„¸ìš”:

```bash
#!/bin/bash
# run_tests.sh

echo "ğŸ³ Docker Compose í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹œì‘..."

# Docker Compose ì‹¤í–‰
docker-compose -f ../docker-compose.dev.yml up -d

# ì„œë¹„ìŠ¤ ì¤€ë¹„ ëŒ€ê¸°
echo "â³ ì„œë¹„ìŠ¤ ì¤€ë¹„ ì¤‘... (30ì´ˆ ëŒ€ê¸°)"
sleep 30

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
echo "ğŸ” ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸:"
docker-compose -f ../docker-compose.dev.yml ps

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
echo "ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
docker-compose -f ../docker-compose.dev.yml exec rag-server pytest tests/ -v

# ì •ë¦¬
echo "ğŸ§¹ í™˜ê²½ ì •ë¦¬ ì¤‘..."
docker-compose -f ../docker-compose.dev.yml down -v

echo "âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ!"
```

## ğŸš« **ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒë“¤**

### âŒ ë¡œì»¬ì—ì„œ ì§ì ‘ ì„œë¹„ìŠ¤ ì‹¤í–‰í•˜ê³  í…ŒìŠ¤íŠ¸

```bash
# ì´ë ‡ê²Œ í•˜ì§€ ë§ˆì„¸ìš”!
cd rag-server
uvicorn app.main:app --reload &
pytest tests/integration/  # â† ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì™€ í†µì‹  ë¶ˆê°€!
```

### âŒ ì¼ë¶€ ì„œë¹„ìŠ¤ë§Œ Dockerë¡œ ì‹¤í–‰

```bash
# ì´ê²ƒë„ ì•ˆë©ë‹ˆë‹¤!
docker-compose up rag-server  # â† embedding-server, llm-server ì—†ìŒ
pytest tests/
```

### âŒ í…ŒìŠ¤íŠ¸ í›„ Docker í™˜ê²½ ì •ë¦¬ ì•ˆí•¨

```bash
# ì´ì „ í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ ë‚¨ì•„ìˆìœ¼ë©´ í¬íŠ¸ ì¶©ëŒ ë°œìƒ!
docker-compose up -d  # â† ì´ì „ ì»¨í…Œì´ë„ˆì™€ ì¶©ëŒ
```

## âœ… **ì˜¬ë°”ë¥¸ í…ŒìŠ¤íŠ¸ ì›Œí¬í”Œë¡œìš°**

### 1. ğŸ¬ í…ŒìŠ¤íŠ¸ ì‹œì‘ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ì´ì „ Docker ì»¨í…Œì´ë„ˆë“¤ì´ ëª¨ë‘ ì •ë¦¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] Docker Compose íŒŒì¼ì´ ìµœì‹  ìƒíƒœì¸ì§€ í™•ì¸
- [ ] ê° ì„œë¹„ìŠ¤ì˜ `requirements.txt`ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆëŠ”ì§€ í™•ì¸

### 2. ğŸ”„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë£¨í‹´

```bash
# 1. ì´ì „ í™˜ê²½ ì •ë¦¬
docker-compose down -v
docker system prune -f

# 2. ìƒˆë¡œìš´ í™˜ê²½ êµ¬ì„±
docker-compose -f docker-compose.dev.yml up -d

# 3. ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
curl http://localhost:8000/health  # rag-server
curl http://localhost:8001/health  # embedding-server  
curl http://localhost:8002/health  # llm-server

# 4. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
docker-compose exec rag-server pytest tests/ -v

# 5. ì •ë¦¬
docker-compose down -v
```

## ğŸ› Docker í™˜ê²½ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œë“¤

#### 1. í¬íŠ¸ ì¶©ëŒ ì˜¤ë¥˜

```bash
Error: Port 8000 is already in use
```

**í•´ê²°ì±…:**
```bash
# ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  ì»¨í…Œì´ë„ˆ í™•ì¸
docker ps -a

# íŠ¹ì • í¬íŠ¸ ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
lsof -ti:8000 | xargs kill -9

# ë˜ëŠ” ëª¨ë“  Docker ì»¨í…Œì´ë„ˆ ì •ë¦¬
docker-compose down -v
docker container prune -f
```

#### 2. ì„œë¹„ìŠ¤ ê°„ í†µì‹  ì‹¤íŒ¨

```bash
httpx.ConnectError: [Errno 111] Connection refused
```

**í•´ê²°ì±…:**
```bash
# ì„œë¹„ìŠ¤ê°€ ì™„ì „íˆ ì¤€ë¹„ë˜ì—ˆëŠ”ì§€ í™•ì¸
docker-compose logs rag-server
docker-compose logs embedding-server

# ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ í™•ì¸
docker network ls
docker network inspect <network_name>
```

#### 3. ì˜ì¡´ì„± ì„¤ì¹˜ ì˜¤ë¥˜

```bash
ModuleNotFoundError: No module named 'some_package'
```

**í•´ê²°ì±…:**
```bash
# ì´ë¯¸ì§€ ì¬ë¹Œë“œ
docker-compose build --no-cache

# requirements.txt í™•ì¸
docker-compose exec rag-server pip list
```

## ğŸ“š ì°¸ê³  ìë£Œ

### ê´€ë ¨ íŒŒì¼ë“¤

- [docker-compose.yml](mdc:docker-compose.yml) - ê¸°ë³¸ Docker Compose ì„¤ì •
- [docker-compose.dev.yml](mdc:docker-compose.dev.yml) - ê°œë°œ í™˜ê²½ ì„¤ì •
- [rag-server/Dockerfile](mdc:rag-server/Dockerfile) - RAG ì„œë²„ Docker ì„¤ì •
- [rag-server/requirements.txt](mdc:rag-server/requirements.txt) - Python ì˜ì¡´ì„±

### í…ŒìŠ¤íŠ¸ ê´€ë ¨ íŒŒì¼ë“¤

- [rag-server/tests/conftest.py](mdc:rag-server/tests/conftest.py) - í…ŒìŠ¤íŠ¸ ì„¤ì •
- [rag-server/tests/integration/](mdc:rag-server/tests/integration) - í†µí•© í…ŒìŠ¤íŠ¸
- [rag-server/tests/unit/](mdc:rag-server/tests/unit) - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

## ğŸ¯ **ê¸°ì–µí•´ì•¼ í•  í•µì‹¬ ë©”ì‹œì§€**

> **ğŸ”¥ "ì„œë²„ í…ŒìŠ¤íŠ¸ = Docker Compose í•„ìˆ˜!" ğŸ”¥**
> 
> í…ŒìŠ¤íŠ¸í•˜ê¸° ì „ì— í•­ìƒ ë¬¼ì–´ë³´ì„¸ìš”:
> - "Docker Composeê°€ ì‹¤í–‰ ì¤‘ì¸ê°€?"
> - "ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì¤€ë¹„ë˜ì—ˆë‚˜?"
> - "í…ŒìŠ¤íŠ¸ í›„ í™˜ê²½ì„ ì •ë¦¬í–ˆë‚˜?"

**ì´ ê·œì¹™ì„ ì§€í‚¤ì§€ ì•Šìœ¼ë©´ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•˜ê±°ë‚˜ ë¶€ì •í™•í•œ ê²°ê³¼ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤!**
