---
description: 
globs: 
alwaysApply: true
---
# TDD (Test-Driven Development) ê°€ì´ë“œë¼ì¸

## ğŸ”´ TDD í•„ìˆ˜ ì›ì¹™

**âš ï¸ ì¤‘ìš”: ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” TDDë¥¼ ë°˜ë“œì‹œ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤!**

**ğŸ³ ì¶”ê°€ ì¤‘ìš”ì‚¬í•­: ëª¨ë“  í†µí•© í…ŒìŠ¤íŠ¸ì™€ ì„œë²„ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ëŠ” Docker Compose í™˜ê²½ì—ì„œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤!**

ìì„¸í•œ Docker í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •ì€ [Docker í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ](mdc:.cursor/rules/docker-testing-guide.mdc)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

ëª¨ë“  ì½”ë“œ êµ¬í˜„ì€ ë‹¤ìŒ TDD ì‚¬ì´í´ì„ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤:

### ğŸ”„ Red-Green-Refactor ì‚¬ì´í´

1. **ğŸ”´ Red**: ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì‘ì„±
2. **ğŸŸ¢ Green**: í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ëŠ” ìµœì†Œí•œì˜ ì½”ë“œ ì‘ì„±
3. **ğŸ”µ Refactor**: ì½”ë“œë¥¼ ê°œì„ í•˜ê³  ì¤‘ë³µ ì œê±°

```
âŒ ì˜ëª»ëœ ì ‘ê·¼: êµ¬í˜„ â†’ í…ŒìŠ¤íŠ¸
âœ… ì˜¬ë°”ë¥¸ ì ‘ê·¼: í…ŒìŠ¤íŠ¸ â†’ êµ¬í˜„ â†’ ë¦¬íŒ©í† ë§
```

## ğŸ“ í…ŒìŠ¤íŠ¸ êµ¬ì¡° ê·œì¹™

### 1. ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
tests/
â”œâ”€â”€ conftest.py                    â† ê³µí†µ fixture ë° ì„¤ì •
â”œâ”€â”€ unit/                          â† ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ features/                  â† Features í…ŒìŠ¤íŠ¸
â”‚   â”‚   â”œâ”€â”€ users/                 â† ëª¨ë“ˆë³„ í´ë”
â”‚   â”‚   â”‚   â”œâ”€â”€ test_router.py     â† API ë¼ìš°í„° í…ŒìŠ¤íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ test_service.py    â† ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ test_repository.py â† DB ì ‘ê·¼ í…ŒìŠ¤íŠ¸
â”‚   â”‚   â”‚   â””â”€â”€ test_schema.py     â† ìŠ¤í‚¤ë§ˆ ê²€ì¦ í…ŒìŠ¤íŠ¸
â”‚   â”‚   â””â”€â”€ items/
â”‚   â”‚       â”œâ”€â”€ test_router.py
â”‚   â”‚       â”œâ”€â”€ test_service.py
â”‚   â”‚       â”œâ”€â”€ test_repository.py
â”‚   â”‚       â””â”€â”€ test_schema.py
â”‚   â””â”€â”€ core/
â”‚       â”œâ”€â”€ test_config.py
â”‚       â””â”€â”€ test_security.py
â”œâ”€â”€ integration/                   â† í†µí•© í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ test_user_workflows.py
â”‚   â””â”€â”€ test_api_integration.py
â””â”€â”€ e2e/                          â† End-to-End í…ŒìŠ¤íŠ¸
    â”œâ”€â”€ test_user_journey.py
    â””â”€â”€ test_api_endpoints.py
```

### 2. í…ŒìŠ¤íŠ¸ íŒŒì¼ ë§¤í•‘ ê·œì¹™

**ëª¨ë“  ì†ŒìŠ¤ íŒŒì¼ì— ëŒ€ì‘í•˜ëŠ” í…ŒìŠ¤íŠ¸ íŒŒì¼ì´ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤:**

| ì†ŒìŠ¤ íŒŒì¼ | í…ŒìŠ¤íŠ¸ íŒŒì¼ | í…ŒìŠ¤íŠ¸ íƒ€ì… |
|-----------|-------------|-------------|
| `app/features/users/router.py` | `tests/unit/features/users/test_router.py` | API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ |
| `app/features/users/service.py` | `tests/unit/features/users/test_service.py` | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸ |
| `app/features/users/repository.py` | `tests/unit/features/users/test_repository.py` | ë°ì´í„° ì ‘ê·¼ í…ŒìŠ¤íŠ¸ |
| `app/features/users/schema.py` | `tests/unit/features/users/test_schema.py` | ìŠ¤í‚¤ë§ˆ ê²€ì¦ í…ŒìŠ¤íŠ¸ |
| `app/features/users/model.py` | `tests/unit/features/users/test_model.py` | ëª¨ë¸ í…ŒìŠ¤íŠ¸ |

## ğŸ§ª TDD êµ¬í˜„ ë‹¨ê³„ë³„ ê°€ì´ë“œ

### 1ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë¨¼ì € ì‘ì„± (Red)

```python
# tests/unit/features/users/test_service.py
import pytest
from app.features.users.service import UserService
from app.features.users.schema import UserCreate

def test_create_user_should_return_user_with_id():
    """ì‚¬ìš©ì ìƒì„± ì‹œ IDê°€ í¬í•¨ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•´ì•¼ í•¨"""
    # Given
    user_data = UserCreate(name="í™ê¸¸ë™", email="hong@example.com")
    service = UserService()
    
    # When
    result = service.create_user(user_data)
    
    # Then
    assert result.id is not None
    assert result.name == "í™ê¸¸ë™"
    assert result.email == "hong@example.com"
```

### 2ë‹¨ê³„: ìµœì†Œí•œì˜ êµ¬í˜„ (Green)

```python
# app/features/users/service.py
from app.features.users.schema import UserCreate, UserResponse

class UserService:
    def create_user(self, user_data: UserCreate) -> UserResponse:
        # í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ëŠ” ìµœì†Œí•œì˜ êµ¬í˜„
        return UserResponse(
            id=1,
            name=user_data.name,
            email=user_data.email
        )
```

### 3ë‹¨ê³„: ë¦¬íŒ©í† ë§ (Refactor)

```python
# app/features/users/service.py (ê°œì„ ëœ ë²„ì „)
from app.features.users.schema import UserCreate, UserResponse
from app.features.users.repository import UserRepository

class UserService:
    def __init__(self, repository: UserRepository):
        self.repository = repository
    
    def create_user(self, user_data: UserCreate) -> UserResponse:
        # ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
        user = self.repository.create(user_data.dict())
        return UserResponse.from_orm(user)
```

## ğŸ—ï¸ í…ŒìŠ¤íŠ¸ ì‘ì„± íŒ¨í„´

### 1. Given-When-Then íŒ¨í„´ ì‚¬ìš©

```python
def test_get_user_by_id_should_return_user():
    """IDë¡œ ì‚¬ìš©ì ì¡°íšŒ ì‹œ í•´ë‹¹ ì‚¬ìš©ìë¥¼ ë°˜í™˜í•´ì•¼ í•¨"""
    # Given (ì¤€ë¹„)
    user_id = 1
    expected_user = User(id=1, name="í…ŒìŠ¤íŠ¸", email="test@example.com")
    repository.save(expected_user)
    
    # When (ì‹¤í–‰)
    result = service.get_user_by_id(user_id)
    
    # Then (ê²€ì¦)
    assert result is not None
    assert result.id == user_id
    assert result.name == "í…ŒìŠ¤íŠ¸"
```

### 2. í…ŒìŠ¤íŠ¸ ë„¤ì´ë° ì»¨ë²¤ì…˜

```python
def test_[ë©”ì„œë“œëª…]_should_[ì˜ˆìƒê²°ê³¼]_when_[ì¡°ê±´]():
    """í•œê¸€ë¡œ í…ŒìŠ¤íŠ¸ ëª©ì  ì„¤ëª…"""
    pass

# ì˜ˆì‹œë“¤
def test_create_user_should_raise_exception_when_email_duplicated():
    """ì¤‘ë³µëœ ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ìƒì„± ì‹œ ì˜ˆì™¸ê°€ ë°œìƒí•´ì•¼ í•¨"""
    pass

def test_update_user_should_return_updated_user_when_valid_data():
    """ìœ íš¨í•œ ë°ì´í„°ë¡œ ì‚¬ìš©ì ìˆ˜ì • ì‹œ ìˆ˜ì •ëœ ì‚¬ìš©ìë¥¼ ë°˜í™˜í•´ì•¼ í•¨"""
    pass
```

### 3. Fixture í™œìš©

```python
# tests/conftest.py
import pytest
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from app.db.database import Base

@pytest.fixture
def db_session():
    """í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜"""
    engine = create_engine("sqlite:///:memory:")
    Base.metadata.create_all(engine)
    SessionLocal = sessionmaker(bind=engine)
    session = SessionLocal()
    try:
        yield session
    finally:
        session.close()

@pytest.fixture
def user_service(db_session):
    """UserService ì¸ìŠ¤í„´ìŠ¤"""
    from app.features.users.service import UserService
    from app.features.users.repository import UserRepository
    
    repository = UserRepository(db_session)
    return UserService(repository)
```

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ê·œì¹™

### 1. ìµœì†Œ ì»¤ë²„ë¦¬ì§€ ìš”êµ¬ì‚¬í•­
- **ì „ì²´ ì½”ë“œ ì»¤ë²„ë¦¬ì§€**: ìµœì†Œ 90% ì´ìƒ
- **ê° ëª¨ë“ˆë³„ ì»¤ë²„ë¦¬ì§€**: ìµœì†Œ 85% ì´ìƒ
- **ì¤‘ìš” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**: 100% ì»¤ë²„ë¦¬ì§€

### 2. ì»¤ë²„ë¦¬ì§€ ì¸¡ì • ë° ë³´ê³ 

```python
# pyproject.toml ë˜ëŠ” setup.cfg
[tool.pytest.ini_options]
addopts = "--cov=app --cov-report=html --cov-report=term-missing --cov-fail-under=90"
```

## ğŸš¨ TDD ì²´í¬ë¦¬ìŠ¤íŠ¸

ëª¨ë“  ê¸°ëŠ¥ êµ¬í˜„ ì „ì— ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

- [ ] ğŸ”´ **ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸**ë¥¼ ë¨¼ì € ì‘ì„±í–ˆëŠ”ê°€?
- [ ] ğŸŸ¢ **í…ŒìŠ¤íŠ¸ê°€ í†µê³¼**í•˜ëŠ” ìµœì†Œí•œì˜ ì½”ë“œë¥¼ ì‘ì„±í–ˆëŠ”ê°€?
- [ ] ğŸ”µ **ë¦¬íŒ©í† ë§**ì„ í†µí•´ ì½”ë“œ í’ˆì§ˆì„ ê°œì„ í–ˆëŠ”ê°€?
- [ ] ğŸ“ **í…ŒìŠ¤íŠ¸ëª…**ì´ ëª…í™•í•˜ê³  ì´í•´í•˜ê¸° ì‰¬ìš´ê°€?
- [ ] ğŸ¯ **í…ŒìŠ¤íŠ¸ê°€ í•˜ë‚˜ì˜ ì±…ì„**ë§Œ ê²€ì¦í•˜ëŠ”ê°€?
- [ ] ğŸ”„ **ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ë…ë¦½ì **ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ê°€?

## ğŸ’¡ TDD ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 1. í…ŒìŠ¤íŠ¸ ìš°ì„  ê°œë°œ
```python
# âŒ ì˜ëª»ëœ ìˆœì„œ
def create_user():
    # êµ¬í˜„ë¶€í„° ì‘ì„±
    pass

def test_create_user():
    # ë‚˜ì¤‘ì— í…ŒìŠ¤íŠ¸ ì‘ì„±
    pass

# âœ… ì˜¬ë°”ë¥¸ ìˆœì„œ
def test_create_user():
    # ë¨¼ì € í…ŒìŠ¤íŠ¸ ì‘ì„±
    pass

def create_user():
    # í…ŒìŠ¤íŠ¸ í†µê³¼ë¥¼ ìœ„í•œ êµ¬í˜„
    pass
```

### 2. ì‘ì€ ë‹¨ìœ„ë¡œ ë°˜ë³µ
- í•œ ë²ˆì— í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ë§Œ ì‘ì„±
- í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ë©´ ë°”ë¡œ ë‹¤ìŒ í…ŒìŠ¤íŠ¸ ì‘ì„±
- í° ê¸°ëŠ¥ì€ ì‘ì€ ë‹¨ìœ„ë¡œ ë¶„í•´

### 3. ì˜ë¯¸ìˆëŠ” í…ŒìŠ¤íŠ¸ ì‘ì„±
```python
# âŒ ì˜ë¯¸ì—†ëŠ” í…ŒìŠ¤íŠ¸
def test_add():
    assert add(2, 2) == 4

# âœ… ì˜ë¯¸ìˆëŠ” í…ŒìŠ¤íŠ¸
def test_add_should_return_sum_of_two_positive_numbers():
    """ë‘ ì–‘ìˆ˜ë¥¼ ë”í•  ë•Œ ì˜¬ë°”ë¥¸ í•©ì„ ë°˜í™˜í•´ì•¼ í•¨"""
    result = add(2, 3)
    assert result == 5
```

## ğŸ¯ ê²°ë¡ 

**TDDëŠ” ì„ íƒì´ ì•„ë‹Œ í•„ìˆ˜ì…ë‹ˆë‹¤!**

- ëª¨ë“  ì½”ë“œëŠ” í…ŒìŠ¤íŠ¸ê°€ ë¨¼ì € ì‘ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤
- Red-Green-Refactor ì‚¬ì´í´ì„ ì—„ê²©íˆ ì¤€ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤
- í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ë¥¼ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•´ì•¼ í•©ë‹ˆë‹¤
- ë¦¬íŒ©í† ë§ì€ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•œ í›„ì—ë§Œ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤

ì´ ê·œì¹™ë“¤ì„ ë”°ë¥´ë©´ ë²„ê·¸ê°€ ì ê³  ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ìš´ ê³ í’ˆì§ˆ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
