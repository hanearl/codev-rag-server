---
description: 
globs: 
alwaysApply: true
---
# FastAPI ì½”ë”© í‘œì¤€ ë° ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

## ğŸ¨ ì½”ë”© ìŠ¤íƒ€ì¼ ê°€ì´ë“œ

### 1. íƒ€ì… íŒíŠ¸ í•„ìˆ˜ ì‚¬ìš©
ëª¨ë“  í•¨ìˆ˜ì™€ ë©”ì„œë“œì—ëŠ” íƒ€ì… íŒíŠ¸ë¥¼ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.

```python
from typing import List, Optional
from pydantic import BaseModel

def get_users(limit: int = 10) -> List[UserResponse]:
    pass

async def create_user(user_data: UserCreate) -> UserResponse:
    pass
```

### 2. Pydantic ëª¨ë¸ ë„¤ì´ë° ì»¨ë²¤ì…˜
- **Request ëª¨ë¸**: `{Entity}Create`, `{Entity}Update`
- **Response ëª¨ë¸**: `{Entity}Response`, `{Entity}Detail`
- **Base ëª¨ë¸**: `{Entity}Base`

```python
class UserBase(BaseModel):
    name: str
    email: str

class UserCreate(UserBase):
    password: str

class UserUpdate(BaseModel):
    name: Optional[str] = None
    email: Optional[str] = None

class UserResponse(UserBase):
    id: int
    created_at: datetime
```

### 3. ë¹„ë™ê¸° ì²˜ë¦¬ ê°€ì´ë“œë¼ì¸
- ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì€ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬
- I/O ì‘ì—…ì´ í¬í•¨ëœ ê²½ìš° `async/await` ì‚¬ìš©
- CPU ì§‘ì•½ì  ì‘ì—…ì€ ë™ê¸° í•¨ìˆ˜ë¡œ ì²˜ë¦¬

```python
async def get_user_by_id(user_id: int) -> Optional[User]:
    # DB ì‘ì—…ì€ ë¹„ë™ê¸°
    pass

def calculate_user_score(user_data: dict) -> float:
    # CPU ì§‘ì•½ì  ì‘ì—…ì€ ë™ê¸°
    pass
```

## ğŸ”’ ë³´ì•ˆ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 1. ì˜ì¡´ì„± ì£¼ì…ì„ í†µí•œ ì¸ì¦/ì¸ê°€
```python
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer

security = HTTPBearer()

async def get_current_user(token: str = Depends(security)) -> User:
    # í† í° ê²€ì¦ ë¡œì§
    pass

@router.get("/protected")
async def protected_endpoint(current_user: User = Depends(get_current_user)):
    pass
```

### 2. í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬
```python
from pydantic import BaseSettings

class Settings(BaseSettings):
    database_url: str
    secret_key: str
    
    class Config:
        env_file = ".env"

settings = Settings()
```

## ğŸ“ ë¬¸ì„œí™” ê·œì¹™

### 1. API ì—”ë“œí¬ì¸íŠ¸ ë¬¸ì„œí™”
```python
@router.post("/users", response_model=UserResponse, status_code=201)
async def create_user(
    user_data: UserCreate,
    db: Session = Depends(get_db)
) -> UserResponse:
    """
    ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    
    - **name**: ì‚¬ìš©ì ì´ë¦„ (í•„ìˆ˜)
    - **email**: ì´ë©”ì¼ ì£¼ì†Œ (í•„ìˆ˜, ìœ ë‹ˆí¬)
    - **password**: ë¹„ë°€ë²ˆí˜¸ (í•„ìˆ˜, ìµœì†Œ 8ì)
    
    Returns:
        ìƒì„±ëœ ì‚¬ìš©ì ì •ë³´
    """
    pass
```

### 2. í•¨ìˆ˜/í´ë˜ìŠ¤ Docstring
```python
def validate_email(email: str) -> bool:
    """
    ì´ë©”ì¼ ì£¼ì†Œ í˜•ì‹ì„ ê²€ì¦í•©ë‹ˆë‹¤.
    
    Args:
        email: ê²€ì¦í•  ì´ë©”ì¼ ì£¼ì†Œ
        
    Returns:
        ìœ íš¨í•œ ì´ë©”ì¼ì¸ ê²½ìš° True, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ False
        
    Raises:
        ValueError: ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê²½ìš°
    """
    pass
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê°€ì´ë“œë¼ì¸

### âš ï¸ **ì¤‘ìš”: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ëŠ” Docker Compose í™˜ê²½ì—ì„œ!**

**ì„œë²„ ê°„ í†µì‹ ì´ í¬í•¨ëœ í…ŒìŠ¤íŠ¸ëŠ” ë°˜ë“œì‹œ Docker Compose í™˜ê²½ì—ì„œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.**

ìƒì„¸í•œ Docker í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •ì€ [Docker í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ](mdc:.cursor/rules/docker-testing-guide.mdc)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

### 1. í…ŒìŠ¤íŠ¸ íŒŒì¼ êµ¬ì¡°
```
tests/
â”œâ”€â”€ conftest.py           â† ê³µí†µ fixture
â”œâ”€â”€ test_users/
â”‚   â”œâ”€â”€ test_router.py    â† API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ test_service.py   â† ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ test_repository.py â† DB ì ‘ê·¼ ë¡œì§ í…ŒìŠ¤íŠ¸
```

### 2. í…ŒìŠ¤íŠ¸ ë„¤ì´ë° ì»¨ë²¤ì…˜
```python
def test_create_user_success():
    """ì •ìƒì ì¸ ì‚¬ìš©ì ìƒì„± í…ŒìŠ¤íŠ¸"""
    pass

def test_create_user_with_duplicate_email_should_fail():
    """ì¤‘ë³µ ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ìƒì„± ì‹œ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸"""
    pass
```

### 3. Docker í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œ í•„ìˆ˜!
docker-compose -f docker-compose.dev.yml up -d
sleep 30
docker-compose exec rag-server pytest tests/
docker-compose -f docker-compose.dev.yml down -v
```

## ğŸš¨ ì˜¤ë¥˜ ì²˜ë¦¬ íŒ¨í„´

### 1. ì»¤ìŠ¤í…€ ì˜ˆì™¸ ì •ì˜
```python
class AppException(Exception):
    """ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ë³¸ ì˜ˆì™¸"""
    pass

class UserNotFoundException(AppException):
    """ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"""
    pass

class DuplicateEmailException(AppException):
    """ì¤‘ë³µëœ ì´ë©”ì¼"""
    pass
```

### 2. ì˜ˆì™¸ í•¸ë“¤ëŸ¬
```python
from fastapi import HTTPException, status

@app.exception_handler(UserNotFoundException)
async def user_not_found_handler(request, exc):
    raise HTTPException(
        status_code=status.HTTP_404_NOT_FOUND,
        detail="ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
    )
```

## ğŸ“Š ë¡œê¹… í‘œì¤€

### 1. ë¡œê¹… ì„¤ì •
```python
import logging
import sys

# ë¡œê¹… ì„¤ì •
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    handlers=[
        logging.StreamHandler(sys.stdout),
        logging.FileHandler("app.log")
    ]
)

logger = logging.getLogger(__name__)
```

### 2. ë¡œê¹… ì‚¬ìš© ì˜ˆì‹œ
```python
async def create_user(user_data: UserCreate) -> UserResponse:
    logger.info(f"ìƒˆ ì‚¬ìš©ì ìƒì„± ìš”ì²­: {user_data.email}")
    
    try:
        user = await user_service.create_user(user_data)
        logger.info(f"ì‚¬ìš©ì ìƒì„± ì™„ë£Œ: {user.id}")
        return user
    except Exception as e:
        logger.error(f"ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨: {str(e)}")
        raise
```

## ğŸ”§ ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œ

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ìµœì í™”
- N+1 ì¿¼ë¦¬ ë¬¸ì œ ë°©ì§€ë¥¼ ìœ„í•œ `joinedload` ì‚¬ìš©
- í•„ìš”í•œ í•„ë“œë§Œ ì„ íƒí•˜ëŠ” ì¿¼ë¦¬ ì‘ì„±
- ì¸ë±ìŠ¤ í™œìš© ê³ ë ¤

### 2. ìºì‹± ì „ëµ
```python
from functools import lru_cache

@lru_cache(maxsize=128)
def get_settings() -> Settings:
    return Settings()
```

### 3. í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„
```python
class PaginatedResponse(BaseModel):
    items: List[Any]
    total: int
    page: int
    size: int
    pages: int

@router.get("/users", response_model=PaginatedResponse)
async def get_users(page: int = 1, size: int = 10):
    pass
```

ì´ëŸ¬í•œ ê·œì¹™ë“¤ì„ ë”°ë¥´ë©´ ì¼ê´€ì„± ìˆê³  ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œ FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
